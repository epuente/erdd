@(reactivos:TreeSet[Long], aspectos:List[Aspecto], 
c1:List[ClasificadorCriterio1], c2:List[ClasificadorCriterio2], c3:List[ClasificadorCriterio3], 
version:EvaluacionTablaVersion, versiones:List[EvaluacionTablaVersion],
registros:Int,
tiposrecursos:List[ClasificadorEjemplo]
)
@import helper._
@import play.api.libs.json.Json

@encabezadosTabla()={
		 <thead>
			 <tr>
				 <th rowspan="3" style="vertical-align:middle">Id</th>
				 <th rowspan="3" style="vertical-align:middle">Reactivo</th>
				 <th rowspan="3" style="vertical-align:middle">Aspecto</th>
			 </tr>
			 <tr>
				 @for(tc1<-c1){
					 <th style="text-align:center" colspan="@c2.filter(_.criterio1.id == tc1.id).length">@tc1.descripcion</th>
				 }
				 <td></td>
			 </tr>
			 <tr>
				@for(tc1<-c1){
					 @for(tc2<-c2.filter(_.criterio1.id == tc1.id)){
						 <th style="text-align:center; vertical-align: middle;">@tc2.descripcion</th>
					 }
				 }
			  <td></td>
			 </tr>
		</thead>
}



@main{
	<style>
		.filtrado, mark  {
			background-color:#ffffcc !important;
		}
		.swal-wide{
			width:50rem !important;
			padding-bottom: 5rem;
		}
	</style>
	
    <link rel="stylesheet" media="screen" href="@routes.Assets.at("lib/datatables/css/dataTables.bootstrap.min.css")"/>
   <script src="@routes.Assets.at("jQuery-Selectric/public/jquery.selectric.min.js")" type="text/javascript"></script>   
	<link rel="stylesheet" media="screen" href="@routes.Assets.at("jQuery-Selectric/public/selectric.css")"/>
	
	<link rel="stylesheet" media="screen" href="@routes.Assets.at("lib/datatables-buttons/css/buttons.dataTables.min.css")"/>
	<div class="container-fluid">
			<div class="row" style="padding-bottom: 2px">
				<div class="col-lg-12">
					<ol class="breadcrumb">
					  <li>Catálogos</li>
					  <li class="active">Instrumento de evaluación</li>
					</ol>			
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12" style="height: 100%">
					<div id="mensaje" class="center-block" >
						<div >Cargando, por favor espere... <i class="fa fa-refresh fa-spin fa-lg" style="font-size: 30px"></i></div>						
					</div>				
					<div id="progreso"></div>
				
				    @flashes()				    

					<div style="display: none;" id="principal">



					<!-- Modal -->
					@form(CSRF(routes.AdminEvaluacionTablaController.agregarReactivo()), 'id -> "frmModal2") {
						<input type="hidden" value="@version.id" name="version"></input>	
						<div class="modal fade modal-wide" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
						  <div class="modal-dialog">
						    <div class="modal-content">
						      <div class="modal-header">
						        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						        <h4 class="modal-title" >Agregar reactivo al instrumento de evaluación en la versión @version.version</h4>
						      </div>
						      <div class="modal-body" id="modalBody2" style="height: 60em">
									<input type="hidden" value="@version.id" name="otro"></input>									
									<select  name="reactivo" id ="reactivo"></select>
									<div id="nuevoReactivo" style="display: none;">
										<label>Nuevo texto de reactivo</label>
										<textarea name="nuevoReactivo" style="min-width: 100%" rows="4"></textarea>
									</div>
									<div id="campos">
									   <table class="table table-bordered table-striped" id="tablaAgregarReactivo"  style="width: 100%">
			                                 <thead>
			                                     <tr>
			                                         <th rowspan="3" style="vertical-align:middle">Aspecto</th>
			                                     </tr>
			                                     <tr>
			                                         @for(tc1<-c1){
			                                             <th style="text-align:center" colspan="@c2.filter(_.criterio1.id == tc1.id).length">@tc1.descripcion</th>
			                                         }
			                                     </tr> 
			                                     <tr>
			                                        @for(tc1<-c1){
			                                             @for(tc2<-c2.filter(_.criterio1.id == tc1.id)){
			                                                 <th style="text-align:center; vertical-align: middle;">@tc2.descripcion</th>
			                                             }
			                                         }
			                                     </tr>                                     
			                                </thead>
			                                <tbody></tbody>									   
								       </table>
									</div>								
						      </div>
						      <div class="modal-footer">							      	
						        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
						        <button type="submit" class="btn btn-primary">Agregar reactivo</button>
						        
						        
						      </div>
						    </div>
						  </div>
						</div>	
					}
						
						@form(CSRF(routes.TablaEvaluacionVersionController.versionCreate()), 'id->"frmVersiones"){
							<div class="pull-right">						
								<table id="tablaVersiones" border="1" stye="table-layout: fixed">
									<tr>
										<td style="padding-left: 0.5em; padding-right: 0.5em;">Versiones</td>
											@for(v <- versiones){
													<td align="center "style="padding-left: 0.5em;padding-right: 0.5em; min-width: 2.5em;">
														<a href="@routes.AdminEvaluacionTablaController.listarTabla(v.id)">
															@v.version														
														</a>
														<div id="divCandado@v.id">
															@if(v.numEvaluacionRespuestas != 0){
																<a href="javascript:toggleTabla(@v.id)" data-toggle="popover" role ="button" tabindex="0" title="Versión cerrada" data-content="No es posible agregar o eliminar reactivos en una versión cerrada. De click sobre el candado para abrir o cerrar esta versión." data-trigger="hover">														
																	<i class="fa fa-lock"></i>
																</a>
															
															} else {
																@if(v.terminado.compareTo("N")==0 ){
																	<a href="javascript:toggleTabla(@v.id)" data-toggle="popover" role ="button" tabindex="0" title="Versión abierta" data-content="No es posible agregar o eliminar reactivos en una versión cerrada. De click sobre el candado para abrir o cerrar esta versión." data-trigger="hover">														
																		<i class="fa fa-unlock"></i>
																	</a>															
																} else {
																	@if(v.terminado.compareTo("S")==0 ){
																		<a href="javascript:toggleTabla(@v.id)" data-toggle="popover" role ="button" tabindex="0" title="Versión cerrada" data-content="No es posible agregar o eliminar reactivos en una versión cerrada. De click sobre el candado para abrir o cerrar esta versión." data-trigger="hover">														
																			<i class="fa fa-lock"></i>
																		</a>
																	}																
																}
															}
														</div>
													</td>								
											}
										<td style="padding-left: 0.5em; padding-right: 0.5em;"><a class="btn btn-primary btn-block" onclick="muestraModal()" role="button">Agregar versión  <i class="fa fa-plus"></i></a></td>
									</tr>
								</table>
							</div>
							<!-- Modal -->
							<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							  <div class="modal-dialog">
							    <div class="modal-content">
							      <div class="modal-header">
							        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							        <h4 class="modal-title" id="myModalLabel">Creacion de una nueva versión</h4>
							      </div>
							      <div class="modal-body">
										Se creará una nueva versión del instrumento de evaluación.<br><br>
										Puede crear una versión a partir de cero, o a partir de una copia de la versión que actualmente esta mostradose, para lograrlo marque la casilla "Iniciar como una copia de la versión X".

									  <div><span id="indicador"></span></div>
							      </div>


							      <div class="modal-footer">
							      	<div class="modalPie"> <input type="checkbox" name="cbxcopia" value="sí"></input>    Iniciar como una copia de la versión @version.version</div>
							      	<input type="hidden" name="versionEnPantalla" value="@version.version" >
							        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
							        <!--button type="submit" class="btn btn-primary">Agregar versión</button-->

									 <button type="button" class="btn btn-primary" id="btnAgregarReactivoAjax">Agregar versión</button>

							      </div>
							    </div>
							  </div>
							</div>	

						}						
					
						<h3>Instrumento de evaluación para la versión @version.version</h3>


						<div class="btn-group" data-toggle="buttons" role="group">
						<label class="btn btn-default active">
							<input name="uno" type="radio" value="*" checked> Todos los aspectos
						</label>
						<label class="btn btn-default">
							<input name="uno" type="radio" value="1" > Pedagógicos
						</label>
						<label class="btn btn-default">
							<input name="uno" type="radio" value="2" > Editoriales
						</label>
						<label class="btn btn-default">
							<input name="uno" type="radio" value="3" > Técnicos
						</label>
						<label class="btn btn-default">
							<input name="uno" type="radio" value="4" > Diseño gráfico
						</label>
						</div>					


						@form(CSRF(routes.AdminEvaluacionTablaController.editTablaEvaluacion(version.id)),  'id->"frmTE" ) {		
							<table class="table table-bordered table-striped" id="tablaTabla"  style="width: 100%">
                                @encabezadosTabla()

							</table>
							<!--
				        	<div class="row">
				        		<div class="col-sm-12">
						        	<div class="row">
						        		<div class="col-sm-4">
						        			<input type="button" onclick="botonTempo1()" class="btn btn-default btn-block" value="Marcar criterios">
						        			<input type="button" onclick="botonTempo2()" class="btn btn-default btn-block" value="Marcar tr">
											<input type="button" onclick="botonTempo3()" class="btn btn-default btn-block" value="Marcar todo">
				        				</div>
			        				</div>
					        	</div>
				        	</div>
							-->
						<div class="row">
							<div class="center-block" style="width:30rem;background-color:#ccc;">
								<input type="button" onclick="agregarReactivo()" class="btn btn-primary btn-block" id="btnAgregarReactivo" value="Agregar reactivo">
							</div>
						</div>


						}
					</div>
			</div>
		</div>
	</div>
	

	
}


<script type="text/javascript">
    laTablaDTSS = null;
    let intervalID;

	$(function() {
		$("#principal").hide();
		$('[data-toggle="popover"]').popover();	
		
        $("#mensaje").hide();
        $("#principal").show(); 
        

        
        $('#tablaTabla thead').find('tr:eq(1) th:eq(0), tr:eq(1) th:eq(1)').css("border-left","2px solid grey").css("border-top","2px solid grey");
        $('#tablaTabla thead').find('tr:eq(1) th:eq(1)').css("border-right","2px solid grey");
        
        $('#tablaTabla thead').find('tr:eq(2) th:eq(0), tr:eq(2) th:eq(3)').css("border-left","2px solid grey");
        $('#tablaTabla thead').find('tr:eq(2) th:eq(5)').css("border-right","2px solid grey");
        
        
        $('#tablaTabla tr').find('td:eq(3), td:eq(6)').css("border-left","2px solid grey");
        $('#tablaTabla tr').find('td:eq(9)').css("border-left","2px solid grey");
	
        
        laTablaDTSS = $('#tablaTabla').DataTable( {
            pageLength: 1,
            //lengthMenu: [  [1,3, 5, 10, 25, 50, -1], [1,3, 5, 10, 25, 50, "Todos"]   ],   
            lengthChange: false,
            language: {
                url: "@routes.Assets.at("Spanish.json")" 
			},
            processing: false,
            serverSide: true,
            scrollCollapse: false,
            stateSave: true,
            scrollX: false,
            mark: true,
            autoWidth: true,
            ajax: {
                url:  "/evaluacionTablaEvaluacionListDTSS",
				"data": function ( d ) {
					d.version = "@version.id";
					d.filtroAspecto = $("[name='uno']:checked").val();
 
					// d.custom = $('#myInput').val();
					// etc
            	},				
                contentType: "application/json; charset=utf-8",
                dataType: "json"
            },
            rowId: 'reactivoId',
            "columns": [
                {"data": "reactivoId", sortable: false, search:""},
                {"data": "reactivo", sortable: false,
					render: $.fn.dataTable.render.text()				
				},
                {"data": "aspectoId", 
                    "width": "6em",                
                    render: function ( data, type, row, meta ) {
                    	data="";
                    	@for(aspecto<-aspectos){
                    		data += '<input type="radio" name="aspecto'+row.reactivoId+'" value=@aspecto.id required '
                    		if (@aspecto.id == row.aspectoId){
                    			//data+='checked="checked" ';
                    		}
							if ( $("#divCandado@version.id > a > i").hasClass("fa-lock")==true ){
								data+=' disabled ';
							}
                    		data +=  '>'+' @aspecto.descripcion<br>';
                    	}
                        return data;
                        data="";
                    }                   
                },
                
                
                @for(loopC1 <- 1 to 6){
                    @if(loopC1 == 1){
                    	{"data":"reactivoId",
                    		"width": "10em",	
                            render: function ( data, type, row, meta ) {
                            	data = enPantalla(row,1,1,1) + enPantalla(row,1,1,2);
                                return data;
                            }                     
                    	},
		                	//{"data": "null", "defaultContent": "<button class='btn btn-danger btn-block btn-xs'>?</button>", sortable: false},
                    }
                    @if(loopC1 == 2){
                        {"data":"reactivoId", "width": "10em",
                            render: function ( data, type, row, meta ) {
                                //data = enPantalla(row,1,2,1) + enPantalla(row,1,2,2) + enPantalla(row,1,2,3);                                      
                                data = enPantalla(row,1,2,3) + enPantalla(row,1,2,4) + enPantalla(row,1,2,5);
                                return data;
                            }
                        },
                    }
                    @if(loopC1 == 3){
                        {"data":"reactivoId", "width": "10em",
                            render: function ( data, type, row, meta ) {
                                data = '<input type="checkbox" id="criterio_'+row.reactivoId+'_1_3_1" name="criterio_'+row.reactivoId+'[]" value="1_3_1"> Curso completo <br>'
                                      +'<input type="checkbox" id="criterio_'+row.reactivoId+'_1_3_2" name="criterio_'+row.reactivoId+'[]" value="1_3_2"> Unidad o módulo <br>'
                                      +'<input type="checkbox" id="criterio_'+row.reactivoId+'_1_3_3" name="criterio_'+row.reactivoId+'[]" value="1_3_3"> Tema <br>'
                                      +'<input type="checkbox" id="criterio_'+row.reactivoId+'_1_3_4" name="criterio_'+row.reactivoId+'[]" value="1_3_4"> Concepto <br>';
                             // data = enPantalla(row,1,3,1) + enPantalla(row,1,3,2) + enPantalla(row,1,3,3) + enPantalla(row,1,3,4);
                                data = enPantalla(row,1,3,6) + enPantalla(row,1,3,7) + enPantalla(row,1,3,8) + enPantalla(row,1,3,9);
                                return data;
                            }
                        },
                    }                    
                    @if(loopC1 == 4){
                        {"data":"reactivoId", "width": "10em",
                            render: function ( data, type, row, meta ) {
                                data = '<input type="checkbox" id="criterio_'+row.reactivoId+'_2_4_5" name="criterio_'+row.reactivoId+'[]" value="2_4_5"> Complejo e integrado<br>'
                                      +'<input type="checkbox" id="criterio_'+row.reactivoId+'_2_4_6" name="criterio_'+row.reactivoId+'[]" value="2_4_6"> Modular o subsistema <br>'
                              //  data = enPantalla(row,2,4,5) + enPantalla(row,2,4,6) ;                                      
                                data = enPantalla(row,2,4,10) + enPantalla(row,2,4,11) ;
                                return data;
                            }
                        },
                    }                     
                    @if(loopC1 == 5){
                        {"data":"reactivoId", "width": "10em",
                            render: function ( data, type, row, meta ) {
                                data = '<input type="checkbox" id="criterio_'+row.reactivoId+'_2_5_5" name="criterio_'+row.reactivoId+'[]" value="2_5_5"> Complejo e integrado<br>'
                                      +'<input type="checkbox" id="criterio_'+row.reactivoId+'_2_5_6" name="criterio_'+row.reactivoId+'[]" value="2_5_6"> Modular o subsistema <br>'
                             //   data = enPantalla(row,2,5,5) + enPantalla(row,2,5,6) ;                                      
                                data = enPantalla(row,2,5,12) + enPantalla(row,2,5,13) ;
                                return data;
                            }
                        },
                    }                     
                    @if(loopC1 == 6){
                        {"data":"reactivoId", "width": "10em",
                            render: function ( data, type, row, meta ) {
                                data = '<input type="checkbox" id="criterio_'+row.reactivoId+'_2_6_5" name="criterio_'+row.reactivoId+'[]" value="2_6_5"> Complejo e integrado<br>'
                                      +'<input type="checkbox" id="criterio_'+row.reactivoId+'_2_6_6" name="criterio_'+row.reactivoId+'[]" value="2_6_6"> Modular o subsistema <br>'
                              //  data = enPantalla(row,2,6,5) + enPantalla(row,2,6,6) ;                                      
                                data = enPantalla(row,2,6,14) + enPantalla(row,2,6,15) ;
                                return data;
                            }
                        },
                    }                      
                }
				{"data":null	,
					render: function ( data, type, row, meta ) {
						console.dir(row)
						data='<button type="button" class="btn btn-danger"  name="btnEliminarReactivo'+row.reactivoId+'"  ';
						if ($("#divCandado@version.id > a >i").hasClass("fa-lock")==true){
						data+=" disabled";
						}							
						data+='   >Eliminar</button>';
						return data;		
					}	
					}
              
              ],
            "initComplete": function(e, settings, json){
                $("#tablaTablaUA_wrapper div.row div").removeClass("col-sm-6");
                $("#tablaTablaUA_wrapper div.row div:eq(0)").addClass("col-sm-4");
                $("#tablaTablaUA_wrapper div.row div:eq(2)").addClass("col-sm-8");
                $(".dataTables_filter").css("width","auto");  
                $("input[type='search'].form-control.input-sm").keyup(function(){
                    if( $(this).val().length >0 ){
                        $(this).addClass("filtrado");
                    } else {
                        $(this).removeClass("filtrado");
                    }
                });   
            }        
        });
	
	





        laTablaDTSS.on( 'draw', function () {
            // Leer y marcar los radios y checkboxes
            laTablaDTSS.data().each(function(dato){
            	$("input[type='radio'][name='aspecto"+dato.reactivoId+"'][value='"+dato.aspectoId+"']").prop("checked", true);
                dato.criterios.forEach(function(c){
                	//console.dir(c)
                    $("#criterio_"+dato.reactivoId+"_"+c.c1+"_"+c.c2+"_"+c.c3).prop("checked", true);
                    if(c.trecursos!=undefined){
                    	c.trecursos.forEach(function(tr){
                    		$("input[type='checkbox'][name='tiporecurso_"+dato.reactivoId+"_"+c.c1+"_"+c.c2+"_"+c.c3+"[]'][value="+tr.id+"]").prop("checked", true);
                    	});
                    }
                });
            });
            
            // Habilita / deshabilita tipos de recursos deacuerdo al c3 correspondiente


            $("[name^='criterio_'][name$='[]']").each(function(index){
            	valores = $(this).prop("id").substring(9);
            	checado = $(this).prop("checked");   
				$(this).prop("disabled",  $("#divCandado@version.id > a >i").hasClass("fa-lock")  );   
				$("[name^='btnEliminarReactivo']").prop("disabled",   $("#divCandado@version.id > a >i").hasClass("fa-lock") );


				


				if( @registros>0  ||  $("#divCandado@version.id > a >i").hasClass("fa-lock")  )    {      
				  	$("[name='tiporecurso_"+valores+"[]']").prop("disabled",  true );
					$(this).prop("disabled",  true );
				}else {
            		$("[name='tiporecurso_"+valores+"[]']").prop("disabled",  !checado );
					$(this).prop("disabled",  false );
				}
				
            });
            
            
        } );       
        
	});
	

	
	
	
	
	function botonTempo1(){
		console.log("marcando todos los criterio3")
		$("[id^='criterio_']:enabled:not(:checked)").each(function(){
		//	$(this).prop('enabled', true);
		//	$(this).attr('selected', false);
			$(this).click();
			var numero = $(this).attr("id").split("_")[1];
			
//			$("[name^='tiporecurso_"+numero+"_']:enabled:not(:checked)").each(function(){
	//					$(this).click();
		//			});
		});

		
	}


	function botonTempo3(){
		console.log("marcando todos los ejemplos")
		botonTempo1();
		nreactivo = laTablaDTSS.data()[0].reactivoId;
		$("[name^='tiporecurso_"+nreactivo+"_']:enabled:not(:checked)").each(function(){
			$(this).click();
		});
	}


	function botonTempo2(){
		$("[name^='tiporecurso_']:not(:checked)").each(function(){
			$(this).click();
		});
		
	}
		
	

	function enPantallaNvo(renglon){

		console.log( "renglones " +$("#tablaAgregarReactivo tr").length  )
		console.log( "columnas " +$("#tablaAgregarReactivo td").length  )
		var col=-1;
		renglon.forEach(function(r) {
			if (r.c1==1 && r.c2==1)				col=1;
			if (r.c1==1 && r.c2==2)				col=2;
			if (r.c1==1 && r.c2==3)				col=3;
			if (r.c1==2 && r.c2==4)				col=4;
			if (r.c1==2 && r.c2==5)				col=5;
			if (r.c1==2 && r.c2==6)				col=6;

			console.log("col "+col)
			var componente = '<div class="checkbox" style="padding-bottom: 1.5rem;">'+
								'<label><input type="checkbox" id="criterio_0_'+r.c1+'_'+r.c2+'_1"  name="criterio_0[]"   value="'+r.c1+'_'+r.c2+'_'+r.c3+'" ><strong> '+r.c3d+'</strong></label><br>';
			var ejemplos='<div class="form-group">';
			// ciclo para agregar ejemplos
			r.ejemplos.forEach(function(e){
				ejemplos+='<div class="checkbox">'+
								'<div class="small" style="padding-left: 3rem">'+
									'<input type="checkbox" name="tiporecurso_0_'+r.c1+'_'+r.c2+'_'+r.c3+'[]" value="'+e.tiporecursoid+'" disabled>'+e.tiporecurso+
								'</div>'+
							'</div>';
			});
			ejemplos+="</div>";
			componente+=ejemplos+"</div>";


			$("#tablaAgregarReactivo tr:eq(3) td:eq("+col+")").append(componente);
		});
	}



	// Genera el código de las columnas para las tablas
    function enPantalla(row, c1,c2,c3, esReactivoNuevo=false){
        data="";
        row.todosLosCriterios.forEach(function(cs){
            if ((cs.c1==c1) && (cs.c2==c2) && (cs.c3==c3)){
                data+='<div class="checkbox">';   
                data+='<label>';
                if (esReactivoNuevo){
                	data+= '<input type="checkbox" id="criterio_'+0+'_'+cs.c1+'_'+cs.c2+'_'+cs.c3+'" name="criterio_'+0+'[]" value="'+c1+'_'+c2+'_'+c3+'"';                	
                } else {
                    data+= '<input type="checkbox" id="criterio_'+row.reactivoId+'_'+cs.c1+'_'+cs.c2+'_'+cs.c3+'" name="criterio_'+row.reactivoId+'[]" value="'+c1+'_'+c2+'_'+c3+'"';
                }
                @if((registros>0) || (version.terminado == "S")){ 
                    data+=' disabled="disabled" '; 
                }                
                data+='"><strong> '+cs.c3Descripcion+'</strong></label><br>';

                
                if (cs.ejemplos!=undefined){
                	data+='<div class="form-group">';
	                cs.ejemplos.forEach(function(j){
	                	
	                	data+='<div class="checkbox">';
	                    data+='<div class="small" style="padding-left: 1em">';
	                    if (esReactivoNuevo){
	                    	data+='    <input type="checkbox" name="tiporecurso_'+0+"_"+cs.c1+"_"+cs.c2+"_"+cs.c3+'[]" value='+j.id+' ';
	                    } else{
	                    	data+='    <input type="checkbox" name="tiporecurso_'+row.reactivoId+"_"+cs.c1+"_"+cs.c2+"_"+cs.c3+'[]" value='+j.id+' ';
	                    }
		                    @if((registros!=0) || (version.terminado == "S")){ 
		                        data+=' disabled="disabled" '; 
		                    } 
		                    data+='/> '+j.tiporecurso;
	                    data+='</div>';
	                    data+='</div>';
	                    data+='<br>';
	                });
	                data+='</div>';

                }
                data+='</div>';   
                data+="<br/><br/>";
                data+='</div>';   
            }        	
        });        
        return data;         	
    }	

    

	
	// Cuando se seleccionan los radio de aspecto se graba o borra
    $(document).on("click", "input[type='radio'][name^='aspecto']", function(){
    	nombre = $(this).prop("name");
        numeroReactivo =  nombre.substring( nombre.indexOf("o")+1);   
        console.log(numeroReactivo+"????")
    	
        var o = new Object;   
        o.version = {id: "@version.id"};
        o.reactivo = {"id": numeroReactivo };
        //o.aspecto = {id: $("[name='aspecto"+numeroReactivo+"']:checked").val()};
        o.aspecto = {id: $(this).val()};
		if (o.reactivo.id!=0)
        	LlamadaAjaxGrabaInstrumentoAspecto(o);
    });



	// Cuando se seleccionan los checkboxes de criterios se graba o borra
    $(document).on("click", "input:checkbox[name^='criterio_']", function(){
    	nombre = $(this).prop("name");
        numeroReactivo =  nombre.substring( nombre.indexOf("_")+1,  nombre.indexOf("[]") );   
        criterios = $(this).val();
        console.log("numeroReactivo "+numeroReactivo)
        console.log("criterios "+criterios)
        console.log("[name='tiporecurso_"+numeroReactivo+"_"+criterios+"[]']"+"  *   "+!$(this).prop("checked"))



    	$("[name='tiporecurso_"+numeroReactivo+"_"+criterios+"[]']").prop("disabled" ,  !$(this).prop("checked") );



    	if (!$(this).prop("checked")){
    		$("[name='tiporecurso_"+numeroReactivo+"_"+criterios+"[]']").prop("checked" ,  false );
    	}
        var o = new Object;   
        o.version = {id: "@version.id"};
        o.reactivo = {"id": numeroReactivo };
        o.aspecto = {id: $("[name='aspecto"+numeroReactivo+"']:checked").val()};
        o.criterio1 = {id:   criterios.split("_")[0]  };   
        o.criterio2 = {id:   criterios.split("_")[1]  };
        o.criterio3 = {id:   criterios.split("_")[2]  };
		o.borrado = !$(this).prop("checked");
		if (o.reactivo.id!=0)
        	LlamadaAjaxGrabaInstrumentoCriterio(o);
    });


    // Eliminar reactivo del instrumento
	$( document ).on( "click", "[name^='btnEliminarReactivo']", function() {
		var num = $(this).attr("name").substring(19);		
		console.log("asdfsdfgsdfg")
		
		swal({
		  title: '¿Desea eliminar el reactivo '+num+'?',
		  text: "",
		  type: 'warning',
		  showCancelButton: true,
		  confirmButtonColor: '#3085d6',
		  cancelButtonColor: '#d33',
		  confirmButtonText: 'Si<br>Eliminarlo en esta versión',
		  cancelButtonText: 'No<br>Deseo conservarlo',
		  confirmButtonClass: 'btn btn-success',
		  cancelButtonClass: 'btn btn-danger',
		  buttonsStyling: false,
		  reverseButtons: true,
		  customClass: 'swal-wide'
		}).then((result) => {
		  if (result.value) {
		      var o = new Object;   
		      o.version = {id: "@version.id"};
			  o.reactivo = {"id": num };
			  pagActual =  laTablaDTSS.page.info().page;
			  $.ajax({
				url: '/ajaxEliminaReactivoTablaEvaluacion',
				method: 'POST',
				data: JSON.stringify( {o}),
				contentType: "application/json; charset=utf-8",
				dataType: "json"
			  }).success(function(data){
				console.dir(data)
				if (data.eliminado==true){
					console.log("ELIMINADO")
					laTablaDTSS.ajax.reload(null, true);
					//laTablaDTSS.page(pagActual-1).draw('page');
					$.notify({
						title: "Eliminado:",
						message: "Se eliminó el reactivo "+num+" del instrumento"
					}, {type: 'success'});
				} else {
					alert("error ajax en LlamadaAjaxEliminaReactivo ");
				}
			}).error(function(xhr, status, error) {
				  alert("error rn ajax -  "+ error );
				});
		  } else if (
		    // Read more about handling dismissals
		    result.dismiss === swal.DismissReason.cancel
		  ) {
		    swal(
		      'Cancelado',
		      'Se conserva el reactivo',
		      'error'
		    )
		  }
		})
		
		
	});

	// Genera las opciones del select	
	function agregarReactivo(){	
		var $listado = LlamadaAjaxListaReactivos();	
		$.when($listado).done(function(data){
			console.dir(data)
	          document.getElementById("frmModal2").reset();
	          $("#myModal2").modal('show');
	          $("#reactivo").html(data);
	          $("#nuevoReactivo, #campos").hide();
	          $('#reactivo').selectric();			
		});

	}
		

	

    $(document).on("click", "[name^='tiporecurso_'][name$='[]']", function(){
    	if (  $(this).prop("checked") )
    	    $("[name='"+$(this).prop("name")+"']").closest(".form-group").removeClass("has-error");
    	
    	
        valores = $(this).prop("name");
        
        numeroReactivo =  valores.split("_")[1];
        c1 = valores.split("_")[2];
        c2 = valores.split("_")[3];
        c3 = valores.split("_")[4].substring(0,  valores.split("_")[4].length-2 );
        console.log("reactivo: "+numeroReactivo)
        console.log(c1+" "+c2+" "+c3)
        
        var o = new Object;   
        o.version = {id: "@version.id"};
        o.reactivo = {"id": numeroReactivo };
        o.criterio1 = {id:   c1  };   
        o.criterio2 = {id:   c2  };
        o.criterio3 = {id:   c3  };
        //o.criterio3ejemplo = {id: $(this).val()}
        o.tiporecurso= {id: $(this).val()}
		o.borrado = !$(this).prop("checked");
		if (o.reactivo.id!=0)
        	LlamadaAjaxGrabaInstrumentoTipoRecurso(o);    	
    	
    	
    });	
	
	// Aplica los cambios para el nuevo reactivo
	$("#frmModal2").submit(function(e){
		e.preventDefault();		
		/*
		if ($("#frmModal2 input[type='checkbox'][name^='criterio_'][name$='[]']:checked").length == 0){
			e.preventDefault();
			alert("Debe seleccionar al menos un criterio de la tabla");
		} else {
			return true;
		}
		*/
		//console.clear();
		console.log($("#reactivo option:selected").val())
		console.log
		if (  $("#reactivo option:selected").val()==0  &&     $("textarea[name='nuevoReactivo']").val().length==0  ){
			alert("Debe escribir la redacción del reactivo");
			return false;			
		}

		var $agregar = null;

		var arrObj = new Array;

		$("#frmModal2 input[type='checkbox'][name^='criterio_']:checked").each(function(criterio){
			var auxC = $(this).val(); 
			var obj = new Object;
			var c1 = auxC.split("_")[0];
			var c2 = auxC.split("_")[1];
			var c3 = auxC.split("_")[2];
			obj.version ={ id: @version.id };
			obj.reactivo =  { id : $("#reactivo option:selected").val() };
			obj.nuevoReactivo =  $("textarea[name='nuevoReactivo']").val();
			obj.aspecto = {id : $("#frmModal2 input[type='radio'][name^='aspecto']:checked").val()};
			obj.criterio1 = {id: c1 };
			obj.criterio2 = {id: c2 };
			obj.criterio3 = {id: c3 };
			var arrTipos = new Array;

			

			console.log($("#frmModal2 input[type='checkbox'][name^='tiporecurso_']:checked").length)			

			$("#frmModal2 input[type='checkbox'][name^='tiporecurso_']:checked").each(function(){
				var obj2 = new Object;
				obj2.tiporecurso = {id: $(this).val() };
				arrTipos.push(obj2);
			});

			obj.tiposrecursos = arrTipos;
			arrObj.push( {evaluacionTabla : obj} );
		 //   $agregar = LlamadaAjaxAgregarReactivo(obj);

		});

   		$agregar = LlamadaAjaxAgregarReactivo(arrObj);

		$.when($agregar).done(function(a){
			console.log("todos")
			console.dir(a)
			if (a.agregado){
				$("#myModal2").modal('hide');
				laTablaDTSS.ajax.reload(null, false);
				$.notify({
					title: "Agregado:",
					message: "Se agregó el reactivo al instrumento"
				}, {type: 'success'});
			} else {
				$.notify({
					title: "Error:",
					message: "No fue posible agregar el reactivo al instrumento"
				}, {type: 'danger'});				
			}
		});
		
		
	});
	
	
		
	var toggleTabla = function(idVersion){
		$.post("/toggle/"+idVersion)
		  .done(function(data) {
			  if (data.terminado == "S" ||  data.registros > 0  ){
				  $("#divCandado"+idVersion).html('<a href="javascript:toggleTabla('+idVersion+')" data-toggle="popover" title="Versión cerrada" data-content="No es posible agregar o eliminar reactivos en una versión cerrada. De click sobre el candado para abrir o cerrar esta versión." data-trigger="hover"><i class="fa fa-lock"></i></a>');
				  $("input[type='checkbox']").attr("disabled",true).attr("readonly",true);					  
				  $("input[type='radio']").attr("disabled",true).attr("readonly",true);
				  $("#btnAgregarReactivo").attr("disabled",true);
				  $("[name^='btnEliminarReactivo']").prop("disabled",  true);
			  }
			  if (data.terminado == "N" &&  (data.registros == 0) ){
				  $("#divCandado"+idVersion).html('<a href="javascript:toggleTabla('+idVersion+')" data-toggle="popover" title="Versión abierta" data-content="No es posible agregar o eliminar reactivos en una versión cerrada. De click sobre el candado para abrir o cerrar esta versión." data-trigger="hover"><i class="fa fa-unlock"></i></a>');
				  $("input[type='checkbox']").attr("disabled",false).attr("readonly",false);					  
				  $("input[type='radio']").attr("disabled",false).attr("readonly",false);
				  $("#btnAgregarReactivo").attr("disabled",false);
				  $("[name^='btnEliminarReactivo']").prop("disabled",  false);
			  }		

			  $('[data-toggle="popover"]').popover();		
		  });		
	}		
		
	$("[name='c1[1]']").on("click", function(){
			$("[name='c2[1]'], [name='c2[2]'], [name='c2[3]']").prop("disabled",  !($(this).prop("checked"))  );
			$("[name='c3[1]'], [name='c3[2]'], [name='c3[3]'], [name='c3[4]']").prop("disabled",   !($(this).prop("checked"))    );
	});
	$("[name='c1[2]']").on("click", function(){
		$("[name='c2[4]'], [name='c2[5]'], [name='c2[6]']").prop("disabled",  !($(this).prop("checked"))   );
		$("[name='c3[5]'], [name='c3[6]']").prop("disabled",  !($(this).prop("checked"))   );
});
	
	

	
    var renglonEncabezados1=`
        <tr>            
            <td rowspan="1" colspan="2">Informativos</td>
            <td rowspan="1" colspan="3">Apoyo educativo</td>
            <td rowspan="1" colspan="4">Tratamiento educativo</td>
            <td rowspan="1" colspan="2">Tutorial interactivo o practicador</td>
            <td rowspan="1" colspan="2">Simulador</td>
            <td rowspan="1" colspan="2">Sistema</td>
        </tr>
        <tr>
            <td>Unidad o módulo</td><td>Curso completo</td>
            <td>Tema</td><td>Unidad o módulo</td><td>Curso completo</td>
            <td>Concepto</td><td>Tema</td><td>Unidad o módulo</td><td>Curso completo</td>
            <td>Modular o subsistema</td><td>Complejo e integrado</td>
            <td>Modular o subsistema</td><td>Complejo e integrado</td>
            <td>Modular o subsistema</td><td>Complejo e integrado</td>
        </tr>   `;
	
	
	
	$("#reactivo").on("change", function(){
	    let numReactivo = $(this).val();   		
		if( numReactivo == 0){
			$("#nuevoReactivo, #campos").show();
		} else {
			$("#nuevoReactivo, #campos").hide();
		}
		
        $("#nuevoReactivo, #campos").toggle( numReactivo != -1  );
        //Muestra / oculta label y textarea para el nuevo reactivo
        ($("textarea[name='nuevoReactivo']").toggle( numReactivo == 0  )).parent().find("label").toggle( numReactivo == 0  );
		
		//Mostrar los campos
		@*
		$("#campos").html( '<table class="table table-bordered table-striped table-hover">'+renglonEncabezados1+`@campos(0,true)`+'</table>' );
		*@


		console.log("numReactivo "+numReactivo)
		console.dir("tam laTablaDTSS.data() "+ laTablaDTSS.data().length )
		console.dir(laTablaDTSS.data()[0])
		let linea = laTablaDTSS.data()[0];
		console.log("linea "+ linea)
        var cad = "";
        cad+="<tr>";
        cad+="     <td>";
        @for(aspecto<-aspectos){
            cad += '<input type="radio" name="aspecto'+numReactivo+'" value=@aspecto.id required '
            cad +=  '>'+' @aspecto.descripcion<br>';
        }                
        cad+="     </td>";

		var boolNuevo =   (numReactivo ==0);
		console.log("boolNuevo "+boolNuevo)


		////////////////////////////////////////////////////
		/*
		Se usan los datos que tiene la tabla tblaDTSS, pero si el instrumento es totalmente nuevo,
		no tiene registros y por tanto no hay renglones en el datatables.

		Usar el siguiente query en un método:
		select cc1.id c1, cc2.id c2, cc3.id,
		cc1.descripcion, cc2.descripcion, ccc.descripcion, ct.descripcion, ct.id
		from clasificador_criterio3 cc3
		inner join clasificador_criterio2 cc2 on cc3.criterio2_id = cc2.id
		inner join clasificador_criterio1 cc1  on cc2.criterio1_id = cc1.id
		inner join clasificador_catalogo_criterio3 ccc on cc3.catalogo_id = ccc.id
		inner join clasificador_criterio3ejemplo cce on cc3.id = cce.criterio3_id
		, clasificador_tiporecurso ct
		where cce.tiporecurso_id = ct.id
		*/
		////////////////////////////////////////////////////


		var $x=LlamadaAjax("/baseInstrumento","POST", JSON.stringify({}));
		$.when($x).done(function(data){
			console.dir(data)
			@for(loopC1 <- 1 to 6){
				cad+="<td></td>";
			}

			cad+="</tr>";

			$("#tablaAgregarReactivo tbody tr").remove();
			$("#tablaAgregarReactivo tbody").append(cad);


							enPantallaNvo(data);


			console.log("cad "+cad);








			@*
			if ( !$.fn.dataTable.isDataTable( '#tablaAgregarReactivo' ) ) {
				$("#tablaAgregarReactivo").DataTable(
					{
					"paging":   false,
					"ordering": false,
					"info":     false,
					"searching": false
					}
				);
			}
			*@


		});


		@*
		@for(loopC1 <- 1 to 6){
            cad+="<td>";
			@if(loopC1 == 1){
				console.log("Aquii 10")
				console.log(linea)
				console.log("enPantalla linea,1,1,1, boolNuevo regresa: "+enPantalla(linea,1,1,1, boolNuevo))
				console.log("enPantalla linea,1,1,2, boolNuevo regresa: "+enPantalla(linea,1,1,2, boolNuevo))
				cad+="    "+enPantalla(linea,1,1,1, boolNuevo) + enPantalla(linea,1,1,2, boolNuevo);
			}				
			@if(loopC1 == 2){
				cad+="    "+enPantalla(linea,1,2,3,boolNuevo) + enPantalla(linea,1,2,4, boolNuevo) + enPantalla(linea,1,2,5, boolNuevo);
			}
            @if(loopC1 == 3){
				cad+="    "+enPantalla(linea,1,3,6,boolNuevo) + enPantalla(linea,1,3,7,boolNuevo) + enPantalla(linea,1,3,8,boolNuevo) + enPantalla(linea,1,3,9,boolNuevo);
			}				
			@if(loopC1 == 4){
				cad+="    "+enPantalla(linea,2,4,10,boolNuevo) + enPantalla(linea,2,4,11,boolNuevo) ;
			}   		
            @if(loopC1 == 5){
				cad+="    "+enPantalla(linea,2,5,12,boolNuevo) + enPantalla(linea,2,5,13,boolNuevo) ;
			}  			
			@if(loopC1 == 6){
				cad+="    "+enPantalla(linea,2,6,14,boolNuevo) + enPantalla(linea,2,6,15,boolNuevo) ;
			} 	
			
			cad+="</td>";
		}		
		*@


		
	});
	
	
	function muestraModal(){
		$('#myModal').modal('show');
	}
	

	$("[name='uno']").change(function(){
		laTablaDTSS.column(0).search("");
		laTablaDTSS.column(1).search("");
		laTablaDTSS.column(2).search("");
		laTablaDTSS.column(3).search("");		
		laTablaDTSS.ajax.reload(null, true);
	});




	
	function eliminarReactivo(versionId, ren){
		if (confirm("¿Eliminar reactivo ?")){
			
			$("#frmTE").prop("action", "@routes.AdminEvaluacionTablaController"+"removeTablaEvaluacion?version="+@version.id+"&ren="+ren);
			$("#frmTE").submit();
			alert("eliminado....");
		} else {
			alert("Sin eliminar");
		}
		
	}
	

	
	function LlamadaAjaxGrabaInstrumentoAspecto(evaluaciontabla){
		var d = $.Deferred();
	    $.ajax({
	        url: '/ajaxEditTablaEvaluacionAspecto',
	        method: 'POST',
	        data: JSON.stringify( {evaluaciontabla}),
	        contentType: "application/json; charset=utf-8",
	        dataType: "json"
	    }).success(function(data){
	        if (data.estado == "ok"){
	            laTablaDTSS.ajax.reload(null, false);
	        } else {
alert("error hjk4");
	        }
	        d.resolve(data);
	    }).error(function(xhr, status, error) {
	          d.reject;
	          alert("error rn ajax -  "+ xhr.responseText );
	          alert("error rn ajax -  "+ error );
	          alert("error rn ajax -  "+ xhr);
	        }); 
	    return d.promise();
	}		
	
	
	function LlamadaAjaxGrabaInstrumentoCriterio(evaluaciontabla){
		var d = $.Deferred();
	    $.ajax({
	        url: '/ajaxEditTablaEvaluacionCriterio',
	        method: 'POST',
	        data: JSON.stringify( {evaluaciontabla}),
	        contentType: "application/json; charset=utf-8",
	        dataType: "json"
	    }).success(function(data){
	        if (data.estado == "ok"){
	            
	        } else {
alert("error hjk6");
	        }
	        d.resolve(data);
	    }).error(function(xhr, status, error) {
	          d.reject;
	          alert("error rn ajax -  "+ xhr.responseText );
	          alert("error rn ajax -  "+ error );
	          alert("error rn ajax -  "+ xhr);
	        }); 
	    return d.promise();
	}	

	
    function LlamadaAjaxGrabaInstrumentoTipoRecurso(evaluaciontabla){
        var d = $.Deferred();
        $.ajax({
            url: '/ajaxEditTablaEvaluacionTipoRecurso',
            method: 'POST',
            data: JSON.stringify( {evaluaciontabla}),
            contentType: "application/json; charset=utf-8",
            dataType: "json"
        }).success(function(data){
            if (data.estado == "ok"){
                
            } else {
alert("error hjk6");
            }
            d.resolve(data);
        }).error(function(xhr, status, error) {
              d.reject;
              alert("error rn ajax -  "+ xhr.responseText );
              alert("error rn ajax -  "+ error );
              alert("error rn ajax -  "+ xhr);
            }); 
        return d.promise();
    }   
    
    function LlamadaAjaxEliminaReactivo(evaluaciontabla){
        var d = $.Deferred();
        $.ajax({
            url: '/ajaxEliminaReactivoTablaEvaluacion',
            method: 'POST',
            data: JSON.stringify( {evaluaciontabla}),
            contentType: "application/json; charset=utf-8",
            dataType: "json"
        }).success(function(data){
        	console.dir(data)
            if (data.eliminado){
                
            } else {
                alert("error ajax en LlamadaAjaxEliminaReactivo ");
            }
            d.resolve(data);
        }).error(function(xhr, status, error) {
              alert("error rn ajax -  "+ error );
              d.reject;
            }); 
        return d.promise();
    }    
	
    
    function LlamadaAjaxListaReactivos(version){
    	var d = $.Deferred();  
    	$.ajax({
            method: "GET",
            url: "/listaReactivos/"+@version.id
      })
      .success(function( data ) {
          d.resolve(data);
      })
      .error(function(data){
          alert("error ajax");
          d.reject;
      }); 
      return d.promise();
    }
    
    
    function LlamadaAjaxAgregarReactivo(evaluaciontabla){
    	var d = $.Deferred();    	
        $.ajax({
            method: "POST",
            url: "/ajaxAgregarReactivoTablaEvaluacion",
            data: JSON.stringify( evaluaciontabla),
            contentType: "application/json; charset=utf-8",
            dataType: "json"            
      })
      .success(function( data ) {
          d.resolve(data);
      })
      .error(function(data){
          alert("error ajax");
          d.reject;
      });    	
      return d.promise();
    }


	$("#btnAgregarReactivoAjax").click(function(e){
		console.clear();
		if ($("[name='cbxcopia']").prop("checked")==false){
			$("#frmVersiones").submit();
		}
		var cx =  "";
		if ($("[name='cbxcopia']").prop("checked"))
			cx="si";
		else
			cx="no";
		var vp = @version.version;
		var $x = LlamadaAjax("@routes.TablaEvaluacionVersionController.versionCreateAjax()", "POST", JSON.stringify({"cbxcopia": cx, "versionEnPantalla": vp}));
		$.when($x).done(function(data){
			//console.dir(data)
			if (data.conCopia =="si" && data.nregistros >0){
					// revisarConteo, repetirLlamadoCada1000miliSegundos, idDeLaVersionNueva, cunatosRegistrosSeAgregaran
					intervalID = setInterval(revisarConteo,500,data.etvId, data.nregistros);
					$("#indicador").text("Iniciando copia de "+data.nregistros.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")+" registros, procesando...");
					var arregloOriginal = data.ids;
					var arreglosMasPequenos = [];
					var Llamadas = [];
					var partes = 5;
					for (var i = 0; i < partes; i++) {
					  arreglosMasPequenos.push([]);
					  Llamadas.push([]);
					}
					for (var i = 0; i < arregloOriginal.length; i++) {
					  var indiceArreglo = i % partes;
					  arreglosMasPequenos[indiceArreglo].push(arregloOriginal[i]);
					}
					console.log("...iniciando arreglo Llamadas")
					for (var x=0; x < arreglosMasPequenos.length; x++){
						Llamadas[x] = LlamadaAjax("@routes.TablaEvaluacionVersionController.versionCreateAjaxParcial()", "POST", JSON.stringify({"vorigen": vp, "vdestino": data.etvId, "ids": arreglosMasPequenos[x]  }));
					}
					console.log("...se llamaron Llamadas")

					$.when.apply($, Llamadas)
						.done(function(data){
							clearInterval(intervalID);
							intervalID=null;
							$("#indicador").text("La copia ha terminado");
							setTimeout(() => {
								$('#myModal').modal('hide');
								location.reload();
							}, "1500");
						}).fail(function(e){
							alert("ERROR "+e );
						});
				}
		});
	});


	function revisarConteo(id, total){
		//console.log("-- total "+total)
		//console.log("-- revisarConteo "+id)
		var $z=LlamadaAjax("@routes.TablaEvaluacionVersionController.conteoVersion()", "POST", JSON.stringify({"versionId": id}));
		$.when($z).done(function(dataConteo){
			//console.dir(dataConteo)
			//console.log(total," - ",dataConteo.registros)
			//console.log(total - dataConteo.registros)
			var faltantes = (total - dataConteo.registros);
			$("#indicador").text("Faltan "+faltantes.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")+" registros");
			if (faltantes==77777777777777777777777777777777777777770){
				clearInterval(intervalID);
				intervalID=null;
				$("#indicador").text("La copia ha terminado.....").show();
				setTimeout(() => {
				  	$('#myModal').modal('hide');
					location.reload();
				}, "1500");

			}

		});
	}

</script>

<script src="@routes.Assets.at("lib/datatables/js/jquery.dataTables.min.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("lib/datatables/js/dataTables.bootstrap.min.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("lib/datatables-buttons/js/dataTables.buttons.min.js")" type="text/javascript"></script>


<script src="@routes.Assets.at("mark.js/datatables.mark.min.js")"></script>
<script src="@routes.Assets.at("mark.js/jquery.mark.min.js")"></script>

<script src="@routes.Assets.at("sweetalert2/sweetalert2.all.js")" type="text/javascript"></script>

<script src="@routes.Assets.at("lib/bootstrap-notify/bootstrap-notify.min.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/async.js")" type="text/javascript"></script>


