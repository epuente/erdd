@(registros:Map[String,Int])
@import helper._

@main {
	
	<link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/seantheme.css")"/>
	<script src="@routes.Assets.at("javascripts/highcharts/highcharts.js")" ></script>		
	<script src="@routes.Assets.at("javascripts/highcharts/highcharts-3d.js")" ></script>

	<script src="@routes.Assets.at("javascripts/fullcalendar/moment.min.js")" ></script>

	<div class="container-fluid">
			<div class="row">
				<div class="col-lg-12">
					<ol class="breadcrumb">
					  <li>Inicio</li>
					</ol>			
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
	  	          <h3>Inicio</h3>
		        </div>
			</div>
			
@*			
			<div class="row">
				<div class="col-lg-12">
					<div class="widget widget-stats bg-blue-lighter" >
					 	<small class="pull-right ml"></small>
					 	<small name="dt">asasdfasd</small>
			            <div class="stats-icon stats-icon-sm"><i class="fa fa fa-file-text-o fa-fw"></i></div>
			            <p>Solicitudes de prórroga @registros.get("solPro")</p>
						
					</div>
				</div>
			</div>
*@			
			<div class="row">
				<div class="col-lg-9">
					<div class="row">
						<div class="col-lg-12">
							<div class="panel panel-default">
			                	<div class="panel-heading"><span class="glyphicon glyphicon-list-alt"></span>Estado de solicitudes de evaluación</div>
			               		<div class="panel-body">
			               		
			               			<div class="row">
			               				<div class="col-lg-4">
											<table class="table table-striped table-bordered table-responsive" id="tablaResumen">
												<tr>
													<td><a href="/recursos">Todas las solicitudes</a></td><td><div class="center-block"> @registros.get("rs")</div> </td>
												</tr>		
												<tr>
													<td colspan="1"><a href="/recursos/observarList">Solicitudes por revisar</a></td><td><div class="center-block"> @registros.get("rs1")</div> </td>
												</tr>		
												<tr>
													<td><a href="/recursos/reObservarList">Solicitudes con observaciones</a></td><td> @(registros.get("rs2")+registros.get("rs105"))   </td>
												</tr>
												 <tr>
													<td><a href="/recursos/completoList">Solicitudes aceptadas</a></td><td> @registros.get("rs3")  </td>
												</tr>
												 <tr>
													<td><a href="/oficios">Solicitudes con oficio</a></td><td> @registros.get("rs4")</td>
												</tr>		
												 <tr>
													<td><a href="/clasificacionList">Recursos clasificados</a></td><td> @registros.get("rs5")</td>
												</tr>
												 <tr>
													<td><a href="/asignarEvaluadores">Evaluadores asignados</a></td><td> @registros.get("rs6")</td>
												</tr>
												 <tr>
													<td><a href="/asignarEvaluadores">Evaluadores asignados (parcialmente)</a></td><td> @registros.get("rs6p")</td>
												</tr>
@*
												
												 <tr>
													<td><a href="/mostrarEvaluacionesSinAtender/0">Evaluaciones sin atender</a></td><td> @registros.get("rs6")</td>
												</tr>
												
												 <tr>
													<td><a href="/mostrarEvaluacionesEnProceso/0">Evaluaciones en proceso</a></td><td> @registros.get("rs7")</td>
												</tr>
												<tr>
													<td><a href="/mostrarEvaluacionesPorRevisar/0">Evaluaciones para revisión</a></td><td>@registros.get("rs8")</td>
												 </tr>
												 <tr>
													<td><a href="/mostrarEvaluacionesConObservaciones/0">Evaluaciones con observaciones</a></td><td> @registros.get("rs9")</td>
												</tr>
*@												
												 <tr>
													<td><a href="/listarOficioValoracion">Recursos con oficio de valoración</a></td><td> @registros.get("rs110")</td>
												</tr>

												 <tr>
													<td><a href="/conEncuestasAceptadas">Evaluaciones con encuestas aceptadas</a></td><td> @registros.get("rs12")</td>
												</tr>
												 <tr>
													<td><a href="/solicitudCanceladoList">Solicitudes de cancelación</a></td><td> @registros.get("c0")</td>
												</tr>
												 <tr>
													<td><a href="/canceladoList">Canceladas</a></td><td> @(registros.get("c1")+registros.get("c2"))</td>
												</tr>												
											</table>
			               				</div>
			               				<div class="col-lg-8">
			               					<div>
			               						<div id="container"></div>
			               					</div>
			               				</div>
			               			</div>
							
								</div>
							</div>
						</div>
					</div>



					<div class="row">
						<div class="col-lg-12">
							<div class="panel panel-default">
			                	<div class="panel-heading"><span class="glyphicon glyphicon-list-alt"></span>Detalle de evaluaciones (por cada uno de los aspectos)</div>
			               		<div class="panel-body">
			               			<div class="row" style="">
					               		<div class="col-lg-4">
					               			<div>
					               			<div id="centrar" style="">
											<table class="table table-striped table-bordered table-responsive">
												 <tr>
													<td><a href="/mostrarEvaluacionesSinAtender/1">Evaluaciones sin atender</a></td><td> @registros.get("ev1")</td>
												</tr>								
												 <tr>
													<td><a href="/mostrarEvaluacionesEnProceso/1">Evaluaciones en proceso</a></td><td> @registros.get("ev2")</td>
												</tr>
												<tr>    	
													<td><a href="/mostrarEvaluacionesPorRevisar/1">Evaluaciones para revisión</a></td><td>@registros.get("ev3")</td>
												 </tr>
												 <tr>
													<td><a href="/mostrarEvaluacionesConObservaciones/1">Evaluaciones con observaciones</a></td><td> @registros.get("ev4")</td>
												</tr>
												 <tr>
													<td><a href="/mostrarEvaluacionesConcluidas/1/lg">Evaluaciones concluidas (por cada uno de los aspectos)</a></td><td> @registros.get("ev5")</td>
												</tr>
												 <tr>
													<td><a href="/mostrarEvaluacionesConcluidas/0/lg">Evaluaciones concluidas (los 4 aspectos)</a></td><td> @registros.get("rs10")</td>
												</tr>
												
											</table>
											</div>
											</div>
										</div>
										<div class="col-lg-8">
											<div id="containerEvaluaciones"></div>
										</div>							
								</div>
							</div>
							</div>
						</div>
					</div>     


					<div class="row">
						<div class="col-lg-12">
							<div class="panel panel-default">
			                	<div class="panel-heading"><span class="glyphicon glyphicon-list-alt"></span>Detalle de cancelaciones</div>
			               		<div class="panel-body">
			               			<div class="row" style="">
					               		<div class="col-lg-4">
											<table class="table table-striped table-bordered table-responsive" >
													<tr>
														<td><a href="@routes.RecursoController.canceladosClasificacionList()">Canceladas en clasificación</a></td><td><div class="center-block"> @registros.get("c1")</div> </td>
													<tr>
														<td><a href="@routes.RecursoController.canceladosEvaluacionList()">Canceladas en evaluación</a></td><td> @registros.get("c2")</td>
													</tr>
													<tr>
														<td><a href="/solicitudCanceladoList">Solicitudes de cancelación</a></td><td> @registros.get("c0")</td>
													</tr>
													
											</table>  					               		
					               		
					               		</div>
										<div class="col-lg-8">
											<div id="container2"></div>
										</div>						               		
				               		</div>
			               		</div>
		               		</div> 
	               		</div>
               		</div>


					<div class="row">
						<div class="col-lg-12">
							<div class="panel panel-default">
			                	<div class="panel-heading"><span class="glyphicon glyphicon-list-alt"></span>Comparativo Recursos cerrados vs encuestas</div>
			               		<div class="panel-body">
			               			<div class="row" style="">
					               		<div class="col-lg-4">
											<table class="table table-striped table-bordered table-responsive" >
													<tr>
														<td><a href="mostrarEvaluacionesConcluidas/0/lg">Evaluaciones concluidas</a></td><td><div class="center-block"> @registros.get("rs10")</div> </td>
													<tr>
														<td><a href="/encuestasPorRevisarAdmin">Encuestas por revisar</a></td><td> @registros.get("en1")</td>
													</tr>
													<tr>
														<td><a href="/conObservacionesList">Encuestas con observaciones</a></td><td> @registros.get("en2")</td>
													</tr>
													<tr>
														<td><a href="/terminadasList">Encuestas terminadas</a></td><td> @registros.get("en3")</td>
													</tr>
													
											</table>  					               		
					               		
					               		</div>
										<div class="col-lg-8">
											<div id="container3"></div>
										</div>						               		
				               		</div>
			               		</div>
		               		</div>
	               		</div>
               		</div>

					
				</div>	
				
				
				<aside class="col-lg-3">
					<div class="panel panel-default">
			         	<div class="panel-heading"><span class="fa fa-history"></span>Últimos 10 movimientos</div>

							<div id="log"></div>

			        	
			        </div>				
				</aside>
			</div>
    </div>
}


<script type="text/javascript">
$(function () {
    $('#container').highcharts({
        chart: {
            type: 'pie',
            options3d: {
                enabled: true,
                alpha: 45
            }
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        legend: {
            enabled: false
        },
        plotOptions: {
            pie: {
                innerSize: 100,
                depth: 45,
                shadow: false,
                center: ['50%', '50%']
            }              

        },
        series: [{
            name: 'serieDatos',
            data: [   
                ['Por revisar', @registros.get("rs1")],
                ['Con observaciones', @registros.get("rs2")],
                ['Solicitudes aceptadas', @registros.get("rs3")],
                ['Con oficio', @registros.get("rs4")],
                ['Clasificados', @registros.get("rs5")],
                ['Evaluadores asignados', @registros.get("rs6")],
                ['Evaluadores asignados parcialmente', @registros.get("rs6p")],

                ['Evaluaciones en proceso', @registros.get("rs7")],
                ['Evaluaciones para revisión', @registros.get("rs8")],
                ['Evaluación con observaciones', @registros.get("rs9")],
                ['Evaluación concluida', @registros.get("rs10")],
                ['Con oficio de valoración', @registros.get("rs110")],
            ]
        }],
        tooltip: {
            shared: true,
            useHTML: false,
            formatter: function() {
            	return this.key+" : "+this.y;
            }
            
        },
        credits: {
            position: {
                align: 'left',
                verticalAlign: 'bottom',
                x: -1000,
                y: -1000
            }    
        }
        
        
    });	
    

    $('#containerEvaluaciones').highcharts({
        chart: {
            type: 'pie',
            options3d: {
                enabled: true,
                alpha: 45
            }
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        legend: {
            enabled: false
        },
        plotOptions: {
            pie: {
                innerSize: 100,
                depth: 45,
                shadow: true,
                center: ['50%', '50%']
            }              

        },
        series: [{
            name: 'serieDatos',
            data: [   
                ['Evaluaciones sin atender', @registros.get("ev1")],
                ['Evaluaciones en proceso', @registros.get("ev2")],
                ['Evaluaciones para revisión', @registros.get("ev3")],
                ['Evaluación con observaciones', @registros.get("ev4")],
                ['Evaluación concluida', @registros.get("ev5")]
            ]
        }],
        tooltip: {
            shared: true,
            useHTML: false,
            formatter: function() {
            	return this.key+" : "+this.y;
            }
            
        },
        credits: {
            position: {
                align: 'left',
                verticalAlign: 'bottom',
                x: -1000,
                y: -1000
            }    
        }
        
        
    });	    
    
    
    if (@registros.get("c0") != 0  || @registros.get("c1") != 0  || @registros.get("c2") !=0){    
	    $('#container2').highcharts({
	        chart: {
	            type: 'pie',
	            options3d: {
	                enabled: true,
	                alpha: 45
	            }
	        },
	        title: {
	            text: ''
	        },
	        subtitle: {
	            text: ''
	        },
	        legend: {
	            enabled: false
	        },
	        plotOptions: {
	            pie: {
	                innerSize: 100,
	                depth: 45,
	                shadow: true,
	                center: ['50%', '50%']
	            }              
	
	        },
	        series: [{
	            name: 'serieDatos',
	            data: [   
	                ['Canceladas en clasificación', @registros.get("c1")],
	                ['Canceladas en evaluación', @registros.get("c2")],
	                ['Otras cancelaciones', @registros.get("c0")]
	
	            ]
	        }],
	        tooltip: {
	            shared: true,
	            useHTML: false,
	            formatter: function() {
	            	return this.key+" : "+this.y;
	            }
	            
	        },
	        credits: {
	            position: {
	                align: 'left',
	                verticalAlign: 'bottom',
	                x: -1000,
	                y: -1000
	            }    
	        }
	        
	        
	    });	    
    }    
    
    var chart = new Highcharts.Chart({
        chart: {
            renderTo: 'container3',
            type: 'column',
            margin: 75,
            options3d: {
                enabled: true,
                alpha: 15,
                beta: 15,
                depth: 50,
                viewDistance: 25
            }
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        plotOptions: {
            column: {
                depth: 75
            }
        },
        xAxis: {
        	categories: ["Ev. concluidas", "Enc. por revisar", "Enc. con observaciones","Enc. terminadas"]
        },  
        yAxis:{
            title: {
                text: null
            }        	
        },
        series: [{
        	name: 'Recursos cerrados / Encuestas',
            data:  [{
                name: 'Cerradas',                
                y: @registros.get("rs10")
            }, {
                name: 'Encuestas por revisar',
                y: @registros.get("en1")
            },{
                name: 'Encuestas con observaciones',
                y: @registros.get("en2")
            },{
                name: 'Encuestas terminadas',
                y: @registros.get("en3")
            }]
        }],
        credits: {
            position: {
                align: 'left',
                verticalAlign: 'bottom',
                x: -1000,
                y: -1000
            }     
        },
        legend: {
        	enable: true
        }
    });  
    
    
    
	
	//Actualiza la info de 'movimientos recientes'
    actualiza();
    setInterval(actualiza, 60000);    
});



	function actualiza(){
		$f = LlamadaActualiza();
		 $.when($f).done(
				function(){
					$("[name='dt']").each(function(d){
						aux = moment($(this).html(),  "DD/MM/YYYY HH:mm:ss"  );
						diferencia = moment().diff(aux);
						$("#dif"+$(this).attr("id").substr(2)).html(  moment().diff(  aux,'seconds'  ) +' segundos'  );
						if (diferencia >= 60000){
							$("#dif"+$(this).attr("id").substr(2)).html(  moment().diff(  aux , 'minutes' ) +' minutos'  );
						}
						if (diferencia >= 3600000){
							$("#dif"+$(this).attr("id").substr(2)).html(  moment().diff(  aux , 'hours' ) +' horas'  );
						}
						if (diferencia >= 86400000){
							$("#dif"+$(this).attr("id").substr(2)).html(  moment().diff(  aux , 'days' ) +' días'  );
						}					 
				 	});
		 		}
		 );
		
		
	}

	
	function LlamadaActualiza(){
		 var d = $.Deferred();
	    	$.ajax({
	            method: "GET",
	            url: "/ajaxActualizaLog/10"
	      })
	      .success(function( data ) {
	    	  console.dir(JSON.parse(data))
	    	  var cadena ="";
	    	  for(s=0; s<JSON.parse(data).length; s++ ){
	    		  var obj = JSON.parse(data)[s];
	  	 		if(obj.tipo=="e"){
		  	 		cadena +="<div class='widget widget-stats bg-blue-lighter' >";
		  	 		cadena +="<small id='dif"+obj.consecutivo+"' class='pull-right ml'></small>";
		  	 		cadena +="<small id='dt"+obj.consecutivo+"' name='dt'>"+obj.auditinsert+"</small>";
		  	 		cadena +="    <div class='stats-icon stats-icon-sm'><i class='fa fa fa-file-text-o fa-fw'></i></div>";
		  	 		cadena +="    <p>"+obj.numerocontrol+"</p>";
		  	 		cadena +="    <p>"+obj.recurso+"</p>";
		  	 		cadena +="Estado: "+obj.estado;
		  	 		cadena +="</div>";
	  	 		}
	  		 	if(obj.tipo=="ev"){
					cadena+="<div class='widget widget-stats bg-aqua-lighter'>";
					cadena+="<small id='dif"+obj.consecutivo+"' class='pull-right ml'></small>";
					cadena+="<small id='dt"+obj.consecutivo+"' name='dt'>"+obj.auditinsert+"</small>";
			        cadena+="<div class='stats-icon stats-icon-sm'><i class='fa fa-list-alt fa-fw'></i></div>";
			        cadena+="<p>"+obj.numerocontrol+"</p>";
					cadena+="Estado evaluación: "+obj.estadoevaluacion
					cadena+="</div>";
				}
	  	 		if(obj.tipo=="en"){
					cadena+="<div class='widget widget-stats bg-purple-lighter'>";
					cadena+="<small id='dif"+obj.consecutivo+"' class='pull-right ml'></small>";
	 				cadena+="<small id='dt"+obj.consecutivo+"' name='dt'>"+obj.auditinsert+"</small>";
			        cadena+="<div class='stats-icon stats-icon-sm'><i class='fa fa-check-square-o fa-fw'></i></div>";
			        cadena+="<p>"+obj.numerocontrol+"</p>";
	 				cadena+="Estado encuesta: "+obj.estadoencuesta;		
	 				cadena+="</div>";
				}	  		 	
	    	}
	  	    $( this ).addClass( "done" );
	  	 	$("#log").html(cadena);
	  	 	d.resolve();
	      })
	      .error(function(data){
	          alert("error ajax");
	          d.reject;
	      }); 	
	    	return d.promise();
	}

</script>
<script src="@routes.Assets.at("javascripts/utilerias.js")"></script>
